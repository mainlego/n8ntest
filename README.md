# –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π n8n

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º n8n workflow automation.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- n8n (–≤–µ—Ä—Å–∏—è 1.0+)
- PostgreSQL (–≤–µ—Ä—Å–∏—è 12+)
- API endpoint –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
   ```bash
   psql -U postgres -d your_database < database/init.sql
   ```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   ```bash
   cp .env.example .env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
   ```

3. **–ò–º–ø–æ—Ä—Ç workflow –≤ n8n**
   - –û—Ç–∫—Ä–æ–π—Ç–µ n8n UI
   - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `workflows/`:
     - `1-schedule-notifications.json`
     - `2-send-notifications.json`
     - `3-cancel-notifications.json`

4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ credentials –≤ n8n**
   - –°–æ–∑–¥–∞–π—Ç–µ PostgreSQL credentials —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ `.env`
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã –≤ n8n

5. **–ê–∫—Ç–∏–≤–∞—Ü–∏—è workflow**
   - –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ç—Ä–∏ workflow –≤ n8n UI

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### Workflow #1: Schedule Notifications
–ü—Ä–∏–Ω–∏–º–∞–µ—Ç webhook –∑–∞–ø—Ä–æ—Å—ã –∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –¥–≤–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
- –ó–∞ –¥–µ–Ω—å –¥–æ —Å–æ–±—ã—Ç–∏—è –≤ 21:00
- –ó–∞ 3 —á–∞—Å–∞ –¥–æ –Ω–∞—á–∞–ª–∞ —Å–æ–±—ã—Ç–∏—è

**Endpoint:** `POST /webhook/schedule-notification`

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "activity_date": "2025-08-25",
  "activity_id": "evt_12345", 
  "activity_time": "14:30",
  "activity_url": "https://example.com/manage/evt_12345",
  "activity_qr": "https://example.com/qr/evt_12345.png",
  "id": "user_67890"
}
```

### Workflow #2: Send Notifications
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥.

### Workflow #3: Cancel Notifications
–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å –≤—Å–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è.

**Endpoint:** `DELETE /webhook/cancel-notifications/:activity_id`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Linux/macOS
```bash
chmod +x tests/test-notifications.sh
./tests/test-notifications.sh
```

### Windows
```powershell
.\tests\test-notifications.ps1
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ webhook –∑–∞—â–∏—â–µ–Ω—ã API –∫–ª—é—á–∞–º–∏ —á–µ—Ä–µ–∑ header `X-API-Key`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è SQL injection
- Rate limiting (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ n8n)

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤–∫–ª—é—á–∞–µ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
```sql
SELECT * FROM notification_statistics;
```

–î–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π:
```sql
SELECT cleanup_old_notifications();
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
n8ntest/
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ init.sql              # SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îú‚îÄ‚îÄ 1-schedule-notifications.json
‚îÇ   ‚îú‚îÄ‚îÄ 2-send-notifications.json
‚îÇ   ‚îî‚îÄ‚îÄ 3-cancel-notifications.json
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test-notifications.sh  # –¢–µ—Å—Ç—ã –¥–ª—è Linux/macOS
‚îÇ   ‚îî‚îÄ‚îÄ test-notifications.ps1 # –¢–µ—Å—Ç—ã –¥–ª—è Windows
‚îú‚îÄ‚îÄ .env.example               # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ README.md                  # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

- **Schedule interval:** 30 —Å–µ–∫—É–Ω–¥ (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ Workflow #2)
- **Batch size:** 10 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞ —Ä–∞–∑ (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ SQL –∑–∞–ø—Ä–æ—Å–µ)
- **Retry count:** 3 –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- **Timeout:** 2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å –∫ API

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ n8n
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Workflow #2 –∞–∫—Ç–∏–≤–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏

### –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã (YYYY-MM-DD)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ (HH:MM)
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –≤ –±—É–¥—É—â–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ credentials –≤ n8n
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT